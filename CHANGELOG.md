# 更新日志

本文档记录了本项目的所有重要变更。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
并且本项目遵循 [语义化版本](https://semver.org/lang/zh-CN/spec/v2.0.0.html)。

## [未发布]

## [1.2.6] - 2026-02-13

### 安全
- **Cookie-based 认证系统**
  - 使用 HttpOnly Cookie 替代 localStorage 存储 token，提升安全性
  - WebSocket 连接改为通过 Cookie 进行认证，避免 token 暴露在 URL 中
  - 实现服务端会话管理，支持会话过期自动刷新

### 变更
- 重构认证流程，前端登录后由服务端设置 Cookie
- 新增欢迎页面图片资源

## [1.2.5] - 2026-02-13

### 新增
- 仪表板头部添加过渡进度条，提升数据切换体验
- 为数据部件实现骨架屏加载状态
- 新增 `ClientOnly` 组件，优化客户端渲染
- 新的 API hooks（devices、traffic、rules、proxies），统一数据获取逻辑
- 展示模式下的时间范围限制
- 展示模式下支持后端切换
- 增强规则链流可视化，支持合并零流量链

### 优化
- Traffic Trend 骨架屏加载体验，避免空状态闪动
- Top Domains/Proxies/Regions 骨架屏高度与实际内容保持一致
- 数据库批量 upserts 使用子事务优化性能
- GeoIP 服务可靠性增强，添加失败冷却和队列限制
- 实现 WebSocket 摘要缓存，减少重复数据传输
- 增强设置和主题选项的国际化（i18n）支持
- 改进 API 错误处理机制

### 修复
- 骨架屏使用 `Math.random()` 导致的 Hydration Mismatch 错误
- 登录对话框暗黑主题样式优化
- 修复登录对话框自动聚焦问题
- 优化过渡状态判断逻辑

## [1.2.0] - 2026-02-12

### 新增
- **基于 Token 的身份认证系统**
  - 新增登录对话框
  - 认证守卫 (Auth Guard)
  - 对应的后端认证服务
- **展示模式 (Showcase Mode)**
  - 限制后端操作和配置更改
  - URL 掩码保护，提升安全性
  - 标准化的禁止访问错误提示
  - 完善访问控制检查
- WebSocket Token 验证，保障实时通信安全

### 优化
- 更新项目描述
- 优化 UI 布局，提升响应式体验
- 新增 Windows 系统检测 Hook

## [1.1.0] - 2026-02-11

### 变更
- **项目品牌重塑**：从 "Clash Master" 更名为 "Neko Master"
  - 更新所有素材和品牌标识
  - 包作用域从 `@clashmaster` 更改为 `@neko-master`
  - 清理遗留引用
- 重构 Web 应用组件目录结构，划分为 `common`、`layout` 和 `features` 三个目录
- 将 API 路由从单体 `api.ts` 迁移到专用控制器
- 引入新的 `collector` 服务用于后端数据管理

### 新增
- 骨架屏加载效果，提升用户体验
- 域名预览及一键复制功能

## [1.0.5] - 2026-02-07

### 变更
- **升级至 Next.js 16**
- 将 Manifest 迁移为动态生成

### 修复
- 确保 Manifest 正确输出到 HTML head
- 添加 Docker 开发镜像标签

## [1.0.4] - 2026-02-08 ~ 2026-02-10

### 新增
- **WebSocket 实时数据支持**
  - WebSocket 推送间隔控制
  - Service Worker 缓存，增强连接稳定性
  - 客户端推送间隔控制
- 国家流量列表排序（支持按流量和连接数排序）
- `useStableTimeRange` Hook，确保时间范围一致性
- `keepPreviousByIdentity` 查询占位符
- `ExpandReveal` UI 组件
- 自动刷新旋转动画

### 性能优化
- 优化 WebSocket 数据包大小和推送频率
- 通过批量处理提升 GeoIP 查询效率
- 使用组件记忆化优化规则链流渲染
- 节流数据更新，降低性能开销
- 基于活跃标签页的按需数据获取

### 变更
- 将数据获取迁移至 `@tanstack/react-query`，改善状态管理和缓存
- 增强 Top Domains 图表，支持堆叠流量和自获取数据
- 添加国旗字体，优化国家/地区展示

## [1.0.3] - 2026-02-07 ~ 2026-02-08

### 新增
- **交互式规则统计**
  - 支持分页的域名/IP 表格
  - 代理链追踪
  - 零流量规则展示
- **设备统计** - 专用表格和后端采集
- **IP 统计** - 详细信息展示
- **域名统计** - 支持筛选功能
- 交互式统计的时间范围过滤
- `CountryFlag` 组件，可视化展示国家/地区
- 实时流量统计采集
- 规则链流可视化支持缩放
- 自定义日期范围显示格式
- 日历布局重构为 CSS Grid 实现

### 变更
- 数据清理重构为使用分钟级统计
- 优化关于对话框中的版本状态展示

## [1.0.2] - 2026-02-06 ~ 2026-02-07

### 新增
- **PWA（渐进式 Web 应用）支持**
  - Service Worker 实现
  - Manifest 配置文件
  - PWA 安装功能
- **交互式代理统计**
  - 详细的域名和 IP 表格
  - 排序和分页功能
  - 单代理流量分解
- 数据库数据保留管理
- Favicon 提供商选择
- Docker 健康检查
- 后端配置验证
- Toast 通知，提升交互体验
- 关于对话框，展示版本信息
- API 端点：按 ID 测试现有后端连接

### 变更
- 标准化 Dockerfile、docker-compose 和 Next.js 配置中的端口环境变量
- Docker 镜像标签添加 package.json 版本号
- 自动化 Docker Hub 描述更新
- 优化仪表板移动端表格体验
- 改进滚动条和后端错误处理 UI

### 基础设施
- 新增 CI/CD 工作流
  - 开发分支清理工作流
  - 预览分支创建工作流
  - 增强 Docker 镜像标签策略

## [1.0.1] - 2026-02-06

### 新增
- 英文 README 文档
- 主 README 支持语言选择

### 变更
- 添加首次使用设置截图，丰富 README 内容
- 更新 README 头部样式，使用更大的 Logo
- 更新 Docker 部署文档，推荐使用 Docker Hub 预构建镜像

## [1.0.0] - 2026-02-06

### 新增
- Clash Master 初始版本发布
- 现代化的边缘网关流量分析仪表板
- 实时网络流量可视化
- 后端管理和配置
- Docker 部署支持
- 多后端支持
- 流量统计概览
- 国家/地区流量分布
- 代理流量统计
- 基于规则的流量分析
